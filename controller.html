<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Marathon Controller</title>
  <style>
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; padding: 18px; }
    .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom: 12px; }
    input { padding:10px 12px; font-size:16px; width: 160px; }
    button { padding:10px 12px; font-size:16px; cursor:pointer; }
    .muted { opacity:0.7; }
    .ok { color:#0a7; font-weight:800; }
    .bad { color:#c22; font-weight:800; }
    code { background: #f3f3f3; padding: 2px 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <h2>Honolulu Marathon Controller</h2>

  <div class="row">
    <label>Miles:</label>
    <input id="miles" type="number" step="0.1" min="0" max="26.2" value="0" />
    <button id="m1">-1</button>
    <button id="m01">-0.1</button>
    <button id="p01">+0.1</button>
    <button id="p1">+1</button>
    <button id="send">Update</button>
    <button id="reset">Reset</button>
  </div>

  <p class="muted">Writes require anonymous auth. If this page loads, it will auto-sign-in.</p>
  <p>Status: <span id="status" class="muted">starting…</span></p>

  <p class="muted">Overlay listens to <code>state/miles</code> in Realtime Database.</p>

  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-database-compat.js"></script>

  <script>
 // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyC5jx_D-VqD6Rgk-n9VLupGyG2y3wJS_nQ",
  authDomain: "brad-marathon-tracker.firebaseapp.com",
  databaseURL: "https://brad-marathon-tracker-default-rtdb.firebaseio.com",
  projectId: "brad-marathon-tracker",
  storageBucket: "brad-marathon-tracker.firebasestorage.app",
  messagingSenderId: "803278898242",
  appId: "1:803278898242:web:ab632539fa7f6c690699db",
  measurementId: "G-QCHWN501XC"
};

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    const milesEl = document.getElementById('miles');
    const statusEl = document.getElementById('status');

    function setStatus(text, cls){
      statusEl.className = cls || 'muted';
      statusEl.textContent = text;
    }
    function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }

    async function signIn(){
      try{
        setStatus('signing in…', 'muted');
        await auth.signInAnonymously();
        setStatus('signed in ✅', 'ok');
      } catch (e){
        setStatus('auth failed (check Anonymous Auth is enabled)', 'bad');
        console.error(e);
      }
    }

    async function updateMiles(){
      const miles = clamp(Number(milesEl.value)||0, 0, 26.2);
      milesEl.value = miles.toFixed(1);

      try{
        setStatus('updating…', 'muted');
        await db.ref('state/miles').set(miles);
        setStatus(`updated to ${miles.toFixed(1)} mi ✅`, 'ok');
      } catch(e){
        setStatus('write failed (check DB rules)', 'bad');
        console.error(e);
      }
    }

    // Buttons
    document.getElementById('send').onclick = updateMiles;
    document.getElementById('reset').onclick = () => { milesEl.value = "0.0"; updateMiles(); };
    document.getElementById('p01').onclick = () => { milesEl.value = (+milesEl.value + 0.1).toFixed(1); updateMiles(); };
    document.getElementById('m01').onclick = () => { milesEl.value = (+milesEl.value - 0.1).toFixed(1); updateMiles(); };
    document.getElementById('p1').onclick  = () => { milesEl.value = (+milesEl.value + 1).toFixed(1); updateMiles(); };
    document.getElementById('m1').onclick  = () => { milesEl.value = (+milesEl.value - 1).toFixed(1); updateMiles(); };

    // Load current miles live
    db.ref('state/miles').on('value', (snap) => {
      const v = Number(snap.val());
      if (isFinite(v)) milesEl.value = v.toFixed(1);
    });

    // Start
    signIn();
  </script>
</body>
</html>
